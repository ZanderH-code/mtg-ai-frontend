<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MTG AI ÊêúÁ¥¢Â∑•ÂÖ∑</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #0a0a0a;
        min-height: 100vh;
        padding: 20px;
        color: #ffffff;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: #1a1a1a;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        border: 1px solid #333333;
      }

      .header {
        background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
        color: white;
        padding: 30px;
        text-align: center;
        border-bottom: 1px solid #333333;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .api-status {
        margin-top: 15px;
      }

      .api-badge {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .api-badge.aihubmix {
        background: #28a745;
        color: white;
      }

      .api-badge.openai {
        background: #007bff;
        color: white;
      }

      .api-badge.demo {
        background: #ffc107;
        color: #212529;
      }

      .api-badge.fallback {
        background: #6c757d;
        color: white;
      }

      .search-section {
        padding: 40px;
        background: #1a1a1a;
      }

      .search-box {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
      }

      .search-input {
        flex: 1;
        padding: 15px 20px;
        border: 2px solid #374151;
        border-radius: 10px;
        font-size: 16px;
        transition: border-color 0.3s;
        background: #2d2d2d;
        color: #ffffff;
      }

      .search-input:focus {
        outline: none;
        border-color: #3b82f6;
        background: #374151;
      }

      .search-input::placeholder {
        color: #9ca3af;
      }

      .search-input:focus {
        outline: none;
        border-color: #667eea;
      }

      .search-btn {
        padding: 15px 30px;
        background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .search-btn:hover {
        transform: translateY(-2px);
      }

      .search-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .sort-options {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .sort-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .sort-group label {
        color: #e5e7eb;
        font-size: 14px;
        font-weight: 500;
      }

      .sort-select {
        padding: 8px 12px;
        border: 2px solid #374151;
        border-radius: 6px;
        background: #2d2d2d;
        color: #e5e7eb;
        font-size: 14px;
        cursor: pointer;
        transition: border-color 0.3s;
      }

      .sort-select:focus {
        outline: none;
        border-color: #3b82f6;
      }

      .sort-select option {
        background: #2d2d2d;
        color: #e5e7eb;
      }

      .language-toggle {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .lang-btn {
        padding: 8px 16px;
        border: 2px solid #374151;
        background: #2d2d2d;
        color: #e5e7eb;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .lang-btn.active {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }

      .results-section {
        padding: 0 40px 40px;
        background: #1a1a1a;
      }

      .query-info {
        background: #2d2d2d;
        color: #e5e7eb;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        font-family: monospace;
        font-size: 14px;
        border: 1px solid #374151;
      }

      .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        padding: 20px 0;
      }

      .card {
        border: 1px solid #374151;
        border-radius: 15px;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
        background: #2d2d2d;
        display: flex;
        flex-direction: column;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        border-color: #3b82f6;
        background: #374151;
      }

      .card-image {
        width: 100%;
        background: #374151;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #9ca3af;
        position: relative;
        overflow: hidden;
      }

      .card-image img {
        width: 100%;
        height: auto;
        display: block;
        transition: transform 0.3s;
        border-radius: 8px;
        object-fit: cover;
      }

      .card:hover .card-image img {
        transform: scale(1.02);
      }

      .card-content {
        padding: 20px;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .card-name {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #e5e7eb;
        line-height: 1.3;
      }

      .card-type {
        color: #9ca3af;
        font-size: 14px;
        margin-bottom: 10px;
        font-style: italic;
      }

      .card-text {
        font-size: 14px;
        line-height: 1.6;
        color: #d1d5db;
        flex: 1;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 4;
        -webkit-box-orient: vertical;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #9ca3af;
      }

      .error {
        background: #7f1d1d;
        color: #fecaca;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .example-queries {
        margin-top: 20px;
        padding: 20px;
        background: #2d2d2d;
        border-radius: 10px;
        border: 1px solid #374151;
      }

      .example-queries h3 {
        margin-bottom: 15px;
        color: #e5e7eb;
      }

      .example-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .example-item {
        background: #374151;
        color: #e5e7eb;
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid #4b5563;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
      }

      .example-item:hover {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
        transform: translateY(-1px);
      }

      .settings-bar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .settings-btn,
      .api-info-btn {
        padding: 8px 16px;
        border: 2px solid #374151;
        background: #2d2d2d;
        color: #e5e7eb;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
      }

      .settings-btn:hover,
      .api-info-btn:hover {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
        transform: translateY(-1px);
      }

      @media (max-width: 768px) {
        .search-box {
          flex-direction: column;
        }

        .cards-grid {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .card-content {
          padding: 15px;
        }

        .card-name {
          font-size: 16px;
        }

        .card-text {
          -webkit-line-clamp: 3;
        }
      }

      @media (max-width: 480px) {
        .container {
          margin: 10px;
          border-radius: 15px;
        }

        .search-section {
          padding: 20px;
        }

        .sort-options {
          flex-direction: column;
          gap: 15px;
        }

        .sort-group {
          flex-direction: column;
          align-items: flex-start;
          gap: 5px;
        }

        .results-section {
          padding: 0 20px 20px;
        }

        .cards-grid {
          gap: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 id="pageTitle">üé¥ MTG AI ÊêúÁ¥¢Â∑•ÂÖ∑</h1>
        <p id="pageSubtitle">Áî®Ëá™ÁÑ∂ËØ≠Ë®ÄÊêúÁ¥¢‰∏áÊô∫ÁâåÂç°Áâå</p>
        <div class="api-status" id="apiStatus" style="display: none">
          <span class="api-badge" id="apiBadge"></span>
        </div>
      </div>

      <div class="search-section">
        <div class="language-toggle">
          <button class="lang-btn active" data-lang="zh">‰∏≠Êñá</button>
          <button class="lang-btn" data-lang="en">English</button>
        </div>

        <div class="search-box">
          <input
            type="text"
            class="search-input"
            placeholder="‰æãÂ¶ÇÔºöÂú∞ËêΩÂç°ÁªÑÁöÑÂº∫ÂäõÁªàÁ´Ø"
            id="searchInput"
          />
          <button class="search-btn" id="searchBtn">ÊêúÁ¥¢</button>
        </div>

        <div class="sort-options">
          <div class="sort-group">
            <label for="sortSelect" id="sortLabel">ÊéíÂ∫èÊñπÂºèÔºö</label>
            <select id="sortSelect" class="sort-select">
              <option value="name" data-zh="ÊåâÂêçÁß∞" data-en="By Name">
                ÊåâÂêçÁß∞
              </option>
              <option value="set" data-zh="ÊåâÁ≥ªÂàó" data-en="By Set">
                ÊåâÁ≥ªÂàó
              </option>
              <option
                value="released"
                data-zh="ÊåâÂèëÂ∏ÉÊó•Êúü"
                data-en="By Release Date"
              >
                ÊåâÂèëÂ∏ÉÊó•Êúü
              </option>
              <option value="rarity" data-zh="ÊåâÁ®ÄÊúâÂ∫¶" data-en="By Rarity">
                ÊåâÁ®ÄÊúâÂ∫¶
              </option>
              <option value="color" data-zh="ÊåâÈ¢úËâ≤" data-en="By Color">
                ÊåâÈ¢úËâ≤
              </option>
              <option value="cmc" data-zh="ÊåâÊ≥ïÂäõÂÄº" data-en="By Mana Value">
                ÊåâÊ≥ïÂäõÂÄº
              </option>
              <option value="power" data-zh="ÊåâÂäõÈáè" data-en="By Power">
                ÊåâÂäõÈáè
              </option>
              <option
                value="toughness"
                data-zh="ÊåâÈò≤Âæ°Âäõ"
                data-en="By Toughness"
              >
                ÊåâÈò≤Âæ°Âäõ
              </option>
              <option
                value="edhrec"
                data-zh="ÊåâEDHRecËØÑÂàÜ"
                data-en="By EDHRec Rating"
              >
                ÊåâEDHRecËØÑÂàÜ
              </option>

              <option value="artist" data-zh="ÊåâËâ∫ÊúØÂÆ∂" data-en="By Artist">
                ÊåâËâ∫ÊúØÂÆ∂
              </option>
            </select>
          </div>
          <div class="sort-group">
            <label for="orderSelect" id="orderLabel">ÊéíÂ∫èÈ°∫Â∫èÔºö</label>
            <select id="orderSelect" class="sort-select">
              <option value="asc" data-zh="ÂçáÂ∫è" data-en="Ascending">
                ÂçáÂ∫è
              </option>
              <option value="desc" data-zh="ÈôçÂ∫è" data-en="Descending">
                ÈôçÂ∫è
              </option>
            </select>
          </div>
        </div>

        <div class="settings-bar">
          <button class="settings-btn" id="settingsBtn">‚öôÔ∏è ËÆæÁΩÆ</button>
          <button class="api-info-btn" id="apiInfoBtn">‚ÑπÔ∏è API‰ø°ÊÅØ</button>
        </div>

        <div class="example-queries">
          <h3 id="examplesTitle">üí° ÊêúÁ¥¢Á§∫‰æã</h3>
          <div class="example-list" id="exampleList">
            <!-- ‰∏≠ÊñáÁ§∫‰æã -->
            <div class="example-item zh-example" data-query="Âø´ÊîªÂ•óÁâåÁöÑÂ∞èÂÖµ">
              Âø´ÊîªÂ•óÁâåÁöÑÂ∞èÂÖµ
            </div>
            <div
              class="example-item zh-example"
              data-query="ÊéßÂà∂Â•óÁâåÁöÑÊ∏ÖÂú∫Ê≥ïÊúØ"
            >
              ÊéßÂà∂Â•óÁâåÁöÑÊ∏ÖÂú∫Ê≥ïÊúØ
            </div>
            <div
              class="example-item zh-example"
              data-query="ÂÖ∑ÊúâÈ£ûË°åËÉΩÂäõÁöÑÁîüÁâ©"
            >
              ÂÖ∑ÊúâÈ£ûË°åËÉΩÂäõÁöÑÁîüÁâ©
            </div>
            <div
              class="example-item zh-example"
              data-query="ËâæÊñØÊ≥¢ÊéßÂà∂Â•óÁâåÁöÑÊ≥ïÊúØ"
            >
              ËâæÊñØÊ≥¢ÊéßÂà∂Â•óÁâåÁöÑÊ≥ïÊúØ
            </div>
            <div class="example-item zh-example" data-query="‰ªáÊÅ®ÁÜä">
              ‰ªáÊÅ®ÁÜä
            </div>
            <div class="example-item zh-example" data-query="ÁªÑÂêàÊäÄÁöÑÂºïÊìéÂç°">
              ÁªÑÂêàÊäÄÁöÑÂºïÊìéÂç°
            </div>
            <div class="example-item zh-example" data-query="Á∫¢Ëâ≤ÁÉßÁâå">
              Á∫¢Ëâ≤ÁÉßÁâå
            </div>
            <div class="example-item zh-example" data-query="Á©øÈÄèÁîüÁâ©">
              Á©øÈÄèÁîüÁâ©
            </div>
            <!-- Ëã±ÊñáÁ§∫‰æã -->
            <div class="example-item en-example" data-query="aggro deck dorks">
              aggro deck dorks
            </div>
            <div
              class="example-item en-example"
              data-query="control deck wraths"
            >
              control deck wraths
            </div>
            <div
              class="example-item en-example"
              data-query="creatures with flying"
            >
              creatures with flying
            </div>
            <div
              class="example-item en-example"
              data-query="esper control spells"
            >
              esper control spells
            </div>
            <div class="example-item en-example" data-query="hate bears">
              hate bears
            </div>
            <div
              class="example-item en-example"
              data-query="combo engine cards"
            >
              combo engine cards
            </div>
            <div class="example-item en-example" data-query="red burn spells">
              red burn spells
            </div>
            <div class="example-item en-example" data-query="evasion creatures">
              evasion creatures
            </div>
          </div>
        </div>
      </div>

      <div class="results-section" id="resultsSection" style="display: none">
        <div class="query-info" id="queryInfo"></div>
        <div class="cards-grid" id="cardsGrid"></div>
      </div>
    </div>

    <script>
      // ËøûÊé•Âà∞‰∫ëÁ´ØÂêéÁ´ØAPI
      const API_BASE_URL = "https://mtg-ai-backend.onrender.com";

      // ËØ≠Ë®ÄÈÖçÁΩÆ
      const translations = {
        zh: {
          pageTitle: "üé¥ MTG AI ÊêúÁ¥¢Â∑•ÂÖ∑",
          pageSubtitle: "Áî®Ëá™ÁÑ∂ËØ≠Ë®ÄÊêúÁ¥¢‰∏áÊô∫ÁâåÂç°Áâå",
          searchPlaceholder: "‰æãÂ¶ÇÔºöÂú∞ËêΩÂç°ÁªÑÁöÑÂº∫ÂäõÁªàÁ´Ø",
          searchBtn: "ÊêúÁ¥¢",
          searchingText: "ÊêúÁ¥¢‰∏≠...",
          examplesTitle: "üí° ÊêúÁ¥¢Á§∫‰æã",
          loadingText: "üîç Ê≠£Âú®ÊêúÁ¥¢Âç°Áâå...",
          noResultsText: "Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÂç°Áâå",
          errorText: "ÊêúÁ¥¢Â§±Ë¥•ÔºåËØ∑ÈáçËØï",
          settingsBtn: "‚öôÔ∏è ËÆæÁΩÆ",
          apiInfoBtn: "‚ÑπÔ∏è API‰ø°ÊÅØ",
          sortLabel: "ÊéíÂ∫èÊñπÂºèÔºö",
          orderLabel: "ÊéíÂ∫èÈ°∫Â∫èÔºö",
          // ÊêúÁ¥¢Á§∫‰æã
          example1: "Âø´ÊîªÂ•óÁâåÁöÑÂ∞èÂÖµ",
          example2: "ÊéßÂà∂Â•óÁâåÁöÑÊ∏ÖÂú∫Ê≥ïÊúØ",
          example3: "ÂÖ∑ÊúâÈ£ûË°åËÉΩÂäõÁöÑÁîüÁâ©",
          example4: "ËâæÊñØÊ≥¢ÊéßÂà∂Â•óÁâåÁöÑÊ≥ïÊúØ",
          example5: "‰ªáÊÅ®ÁÜä",
          example6: "ÁªÑÂêàÊäÄÁöÑÂºïÊìéÂç°",
          example7: "Á∫¢Ëâ≤ÁÉßÁâå",
          example8: "Á©øÈÄèÁîüÁâ©",
        },
        en: {
          pageTitle: "üé¥ MTG AI Search Tool",
          pageSubtitle:
            "Search Magic: The Gathering cards using natural language",
          searchPlaceholder: "e.g.: landfall finisher",
          searchBtn: "Search",
          searchingText: "Searching...",
          examplesTitle: "üí° Search Examples",
          loadingText: "üîç Searching for cards...",
          noResultsText: "No matching cards found",
          errorText: "Search failed, please try again",
          settingsBtn: "‚öôÔ∏è Settings",
          apiInfoBtn: "‚ÑπÔ∏è API Info",
          sortLabel: "Sort by:",
          orderLabel: "Order:",
          // ÊêúÁ¥¢Á§∫‰æã
          example1: "aggro deck dorks",
          example2: "control deck wraths",
          example3: "creatures with flying",
          example4: "esper control spells",
          example5: "hate bears",
          example6: "combo engine cards",
          example7: "red burn spells",
          example8: "evasion creatures",
        },
      };

      let currentLanguage = "zh";
      let currentApiKey = null;
      let currentProvider = null;
      let currentModel = null;

      // ËØ≠Ë®ÄÂàáÊç¢ÂáΩÊï∞
      function switchLanguage(lang) {
        currentLanguage = lang;

        // Êõ¥Êñ∞ÊåâÈíÆÊ†∑Âºè
        document.querySelectorAll(".lang-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.dataset.lang === lang) {
            btn.classList.add("active");
          }
        });

        // Êõ¥Êñ∞È°µÈù¢ÊñáÊú¨
        const t = translations[lang];
        document.getElementById("pageTitle").textContent = t.pageTitle;
        document.getElementById("pageSubtitle").textContent = t.pageSubtitle;
        document.getElementById("searchInput").placeholder =
          t.searchPlaceholder;
        document.getElementById("searchBtn").textContent = t.searchBtn;
        document.getElementById("examplesTitle").textContent = t.examplesTitle;
        document.getElementById("settingsBtn").textContent = t.settingsBtn;
        document.getElementById("apiInfoBtn").textContent = t.apiInfoBtn;

        // Êõ¥Êñ∞ÊéíÂ∫èÈÄâÈ°πÊ†áÁ≠æ
        document.getElementById("sortLabel").textContent = t.sortLabel;
        document.getElementById("orderLabel").textContent = t.orderLabel;

        // Êõ¥Êñ∞ÊéíÂ∫èÈÄâÈ°πÁöÑÈÄâÈ°πÊñáÊú¨
        const sortSelect = document.getElementById("sortSelect");
        const orderSelect = document.getElementById("orderSelect");

        Array.from(sortSelect.options).forEach((option) => {
          option.textContent = option.getAttribute(`data-${lang}`);
        });

        Array.from(orderSelect.options).forEach((option) => {
          option.textContent = option.getAttribute(`data-${lang}`);
        });

        // Êõ¥Êñ∞ÊêúÁ¥¢Á§∫‰æãÊòæÁ§∫
        const zhExamples = document.querySelectorAll(".zh-example");
        const enExamples = document.querySelectorAll(".en-example");

        if (lang === "zh") {
          zhExamples.forEach((item) => (item.style.display = "block"));
          enExamples.forEach((item) => (item.style.display = "none"));
        } else {
          zhExamples.forEach((item) => (item.style.display = "none"));
          enExamples.forEach((item) => (item.style.display = "block"));
        }
      }

      // ÂàùÂßãÂåñËØ≠Ë®ÄÊòæÁ§∫
      switchLanguage("zh");

      // ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆ‰∫ã‰ª∂
      document.querySelectorAll(".lang-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          switchLanguage(btn.dataset.lang);
        });
      });

      // Á§∫‰æãÊü•ËØ¢ÁÇπÂáª
      document.querySelectorAll(".example-item").forEach((item) => {
        item.addEventListener("click", () => {
          document.getElementById("searchInput").value = item.dataset.query;
          performSearch();
        });
      });

      // ÊêúÁ¥¢ÊåâÈíÆÁÇπÂáª
      document
        .getElementById("searchBtn")
        .addEventListener("click", performSearch);

      // ÂõûËΩ¶ÊêúÁ¥¢
      document
        .getElementById("searchInput")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            performSearch();
          }
        });

      // ÊéíÂ∫èÈÄâÈ°πÂèòÂåñÊó∂ÈáçÊñ∞ÊêúÁ¥¢
      function addSortEventListeners() {
        const sortSelect = document.getElementById("sortSelect");
        const orderSelect = document.getElementById("orderSelect");
        
        if (sortSelect) {
          sortSelect.addEventListener("change", () => {
            console.log("ÊéíÂ∫èÊñπÂºèÂèòÂåñ:", sortSelect.value);
            if (document.getElementById("searchInput").value.trim()) {
              performSearch();
            }
          });
        }
        
        if (orderSelect) {
          orderSelect.addEventListener("change", () => {
            console.log("ÊéíÂ∫èÈ°∫Â∫èÂèòÂåñ:", orderSelect.value);
            if (document.getElementById("searchInput").value.trim()) {
              performSearch();
            }
          });
        }
      }
      
      // Á°Æ‰øùDOMÂä†ËΩΩÂÆåÊàêÂêéÁªëÂÆö‰∫ã‰ª∂
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', addSortEventListeners);
      } else {
        addSortEventListeners();
      }

      async function performSearch() {
        const query = document.getElementById("searchInput").value.trim();
        if (!query) return;

        const searchBtn = document.getElementById("searchBtn");
        const resultsSection = document.getElementById("resultsSection");
        const cardsGrid = document.getElementById("cardsGrid");

        // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
        searchBtn.disabled = true;
        const t = translations[currentLanguage];
        searchBtn.textContent = t.searchingText;
        resultsSection.style.display = "block";
        cardsGrid.innerHTML = `<div class="loading">${t.loadingText}</div>`;

        try {
          const response = await fetch(`${API_BASE_URL}/api/search`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              query: query,
              language: currentLanguage,
              api_key: currentApiKey,
              model: currentModel,
              sort: document.getElementById("sortSelect").value,
              order: document.getElementById("orderSelect").value,
            }),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          displayResults(data);
        } catch (error) {
          console.error("Search error:", error);
          const t = translations[currentLanguage];
          cardsGrid.innerHTML = `
                    <div class="error">
                        ‚ùå ${t.errorText}: ${error.message}
                        <br><br>
                        ${
                          currentLanguage === "zh"
                            ? "ËØ∑Ê£ÄÊü•Ôºö"
                            : "Please check:"
                        }
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>${
                              currentLanguage === "zh"
                                ? "ÂêéÁ´ØÊúçÂä°ÊòØÂê¶Ê≠£Âú®ËøêË°å"
                                : "Backend service is running"
                            }</li>
                            <li>${
                              currentLanguage === "zh"
                                ? "APIÂú∞ÂùÄÊòØÂê¶Ê≠£Á°Æ"
                                : "API address is correct"
                            }</li>
                            <li>${
                              currentLanguage === "zh"
                                ? "ÁΩëÁªúËøûÊé•ÊòØÂê¶Ê≠£Â∏∏"
                                : "Network connection is normal"
                            }</li>
                        </ul>
                    </div>
                `;
        } finally {
          searchBtn.disabled = false;
          const t = translations[currentLanguage];
          searchBtn.textContent = t.searchBtn;
        }
      }

      function displayResults(data) {
        const queryInfo = document.getElementById("queryInfo");
        const cardsGrid = document.getElementById("cardsGrid");

        // ÊòæÁ§∫Êü•ËØ¢‰ø°ÊÅØ
        const t = translations[currentLanguage];
        queryInfo.innerHTML = `
                 <strong>${
                   currentLanguage === "zh"
                     ? "Scryfall Êü•ËØ¢ËØ≠Ê≥ï:"
                     : "Scryfall Query:"
                 }</strong> ${data.scryfall_query}<br>
                 <strong>${
                   currentLanguage === "zh" ? "ÊâæÂà∞Âç°ÁâåÊï∞Èáè:" : "Cards Found:"
                 }</strong> ${data.total_cards}
                 ${
                   data.api_provider
                     ? `<br><strong>${
                         currentLanguage === "zh" ? "AIÊèê‰æõÂïÜ:" : "AI Provider:"
                       }</strong> ${data.api_provider.toUpperCase()}`
                     : ""
                 }
             `;

        // ÊòæÁ§∫Âç°Áâå
        if (data.cards.length === 0) {
          const t = translations[currentLanguage];
          cardsGrid.innerHTML = `<div class="loading">üòï ${t.noResultsText}</div>`;
          return;
        }

        cardsGrid.innerHTML = data.cards
          .map(
            (card) => `
                <div class="card" onclick="openScryfallCard('${
                  card.scryfall_uri
                }')" style="cursor: pointer;">
                    <div class="card-image">
                        ${
                          card.image_uris
                            ? `<img src="${card.image_uris.normal}" alt="${card.name}" loading="lazy" onerror="this.src='${card.image_uris.small}'">`
                            : "üÉè ÊöÇÊó†ÂõæÁâá"
                        }
                    </div>
                    <div class="card-content">
                        <div class="card-name">${card.name}</div>
                        <div class="card-type">${card.type_line}</div>
                        <div class="card-text">${
                          card.oracle_text || "Êó†ËßÑÂàôÊñáÊú¨"
                        }</div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // ËÆæÁΩÆÊåâÈíÆÁÇπÂáª
      document.getElementById("settingsBtn").addEventListener("click", () => {
        // Ê∏ÖÈô§ÈÖçÁΩÆÂπ∂Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢
        localStorage.removeItem("mtg_ai_configured");
        localStorage.removeItem("mtg_ai_api_key");
        localStorage.removeItem("mtg_ai_provider");
        window.location.href = "login.html";
      });

      // API‰ø°ÊÅØÊåâÈíÆÁÇπÂáª
      document.getElementById("apiInfoBtn").addEventListener("click", () => {
        const apiKey = localStorage.getItem("mtg_ai_api_key");
        const provider = localStorage.getItem("mtg_ai_provider");
        const model = localStorage.getItem("mtg_ai_model");

        if (apiKey && provider) {
          alert(
            `ÂΩìÂâç‰ΩøÁî®: ${provider.toUpperCase()}\nÊ®°Âûã: ${
              model || "ÈªòËÆ§"
            }\nAPIÂØÜÈí•: ${apiKey.substring(0, 8)}...`
          );
        } else {
          alert("ÂΩìÂâç‰ΩøÁî®ÊºîÁ§∫Ê®°ÂºèÔºåÊó†ÈúÄAPIÂØÜÈí•");
        }
      });

      // Ë∑≥ËΩ¨Âà∞ScryfallÂç°ÁâåÈ°µÈù¢
      function openScryfallCard(scryfallUri) {
        if (scryfallUri) {
          window.open(scryfallUri, "_blank");
        }
      }

      // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁöÑÂàùÂßãÂåñ
      document.addEventListener("DOMContentLoaded", () => {
        console.log("MTG AI Search Tool loaded!");

        // Ê£ÄÊü•APIÈÖçÁΩÆ
        const isConfigured = localStorage.getItem("mtg_ai_configured");
        if (isConfigured !== "true") {
          // Â¶ÇÊûúÊ≤°ÊúâÈÖçÁΩÆÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢
          window.location.href = "login.html";
          return;
        }

        // Âä†ËΩΩAPIÈÖçÁΩÆ
        currentApiKey = localStorage.getItem("mtg_ai_api_key");
        currentProvider = localStorage.getItem("mtg_ai_provider");
        currentModel = localStorage.getItem("mtg_ai_model");

        // ÊòæÁ§∫APIÁä∂ÊÄÅ
        updateApiStatus();
      });

      // Êõ¥Êñ∞APIÁä∂ÊÄÅÊòæÁ§∫
      function updateApiStatus() {
        const apiStatus = document.getElementById("apiStatus");
        const apiBadge = document.getElementById("apiBadge");

        if (currentApiKey && currentProvider) {
          apiStatus.style.display = "block";
          const modelText = currentModel ? ` (${currentModel})` : "";
          apiBadge.textContent = currentProvider.toUpperCase() + modelText;
          apiBadge.className = `api-badge ${currentProvider}`;
        } else {
          apiStatus.style.display = "block";
          apiBadge.textContent = "DEMO";
          apiBadge.className = "api-badge demo";
        }
      }
    </script>
  </body>
</html>
